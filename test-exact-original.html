<!DOCTYPE html>
<html>
<head>
    <title>Test Exact Original API Call</title>
</head>
<body>
    <h1>Test Exact Original HubSpot API Call</h1>
    <button onclick="testOriginal()">Test Original Method</button>
    <pre id="output"></pre>

    <script>
        async function testOriginal() {
            const apiKey = 'pat-na2-[REDACTED]'; // Use environment variable in production
            const output = document.getElementById('output');
            
            output.textContent = 'Testing with exact original method...\n';
            
            // Use EXACT same call as original working version
            const proxyUrl = '/api/hubspot?path=/crm/v3/objects/companies&limit=1';
            
            fetch(proxyUrl, {
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                output.textContent += `Response status: ${response.status}\n`;
                
                if (response.ok) {
                    return response.json();
                } else if (response.status === 401) {
                    throw new Error('Invalid API key or insufficient permissions');
                } else if (response.status === 403) {
                    throw new Error('API key lacks required permissions (crm.objects.companies.read)');
                } else {
                    throw new Error(`API error: ${response.status}`);
                }
            })
            .then(data => {
                output.textContent += `✅ SUCCESS! Found ${data.total || 0} companies.\n`;
                output.textContent += `Data: ${JSON.stringify(data, null, 2)}\n`;
            })
            .catch(error => {
                output.textContent += `❌ ERROR: ${error.message}\n`;
                if (error.message.includes('Failed to fetch')) {
                    output.textContent += 'CORS error - expected in browser\n';
                }
            });
        }
    </script>
</body>
</html>