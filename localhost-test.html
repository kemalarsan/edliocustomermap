<!DOCTYPE html>
<html>
<head>
    <title>Local Customer Map Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        #debug { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            background: white; 
            padding: 15px; 
            z-index: 1000; 
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 400px;
        }
        .debug-section { margin-bottom: 10px; }
        .debug-title { font-weight: bold; color: #333; }
        .debug-count { color: #0066cc; font-weight: bold; }
        .debug-error { color: #cc0000; font-weight: bold; }
        .debug-success { color: #009900; font-weight: bold; }
    </style>
</head>
<body>
    <div id="debug">
        <div class="debug-section">
            <span class="debug-title">Status:</span> <span id="status">Loading...</span>
        </div>
        <div class="debug-section">
            <span class="debug-title">Total Customers:</span> <span id="total-count">-</span>
        </div>
        <div class="debug-section">
            <span class="debug-title">LA Area Customers:</span> <span id="la-count">-</span>
        </div>
        <div class="debug-section">
            <span class="debug-title">Map Center:</span> Los Angeles, CA
        </div>
        <div id="sample-customers" style="margin-top: 10px;"></div>
    </div>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="data.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const totalCountEl = document.getElementById('total-count');
        const laCountEl = document.getElementById('la-count');
        const sampleCustomersEl = document.getElementById('sample-customers');
        
        // Initialize map centered on Los Angeles
        const map = L.map('map').setView([34.0522, -118.2437], 10);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        
        // Check if customers data exists
        if (typeof customers === 'undefined') {
            statusEl.innerHTML = '<span class="debug-error">ERROR: customers data not loaded</span>';
        } else {
            statusEl.innerHTML = '<span class="debug-success">SUCCESS: Data loaded</span>';
            totalCountEl.innerHTML = '<span class="debug-count">' + customers.length + '</span>';
            
            // Define LA area bounds (rough rectangle around LA metropolitan area)
            const laCustomers = customers.filter(c => 
                c.lat >= 33.7 && c.lat <= 34.3 && 
                c.lng >= -118.7 && c.lng <= -117.9
            );
            
            laCountEl.innerHTML = '<span class="debug-count">' + laCustomers.length + '</span>';
            
            // Create marker cluster group
            const markers = L.markerClusterGroup({
                chunkedLoading: true,
                maxClusterRadius: 80
            });
            
            // Add LA customers to map
            laCustomers.forEach(customer => {
                const marker = L.marker([customer.lat, customer.lng])
                    .bindPopup(`
                        <b>${customer.name}</b><br>
                        <strong>State:</strong> ${customer.state}<br>
                        <strong>Type:</strong> ${customer.type}<br>
                        <strong>Location:</strong> ${customer.lat.toFixed(4)}, ${customer.lng.toFixed(4)}<br>
                        <a href="${customer.url}" target="_blank">Visit Website</a>
                    `);
                markers.addLayer(marker);
            });
            
            map.addLayer(markers);
            
            // Show sample customers in debug panel
            if (laCustomers.length > 0) {
                sampleCustomersEl.innerHTML = '<div class="debug-title">Sample LA Customers:</div>';
                laCustomers.slice(0, 5).forEach(c => {
                    sampleCustomersEl.innerHTML += `<div style="font-size: 12px; margin: 2px 0;">${c.name}</div>`;
                });
            }
            
            // Add click handler to show coordinates
            map.on('click', function(e) {
                console.log('Clicked at:', e.latlng.lat, e.latlng.lng);
            });
        }
    </script>
</body>
</html>